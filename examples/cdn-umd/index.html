<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fidbak UMD CDN Example</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 24px; }
      h1 { margin-bottom: 8px; }
      p { color: #4b5563; }
      .box { max-width: 760px; }
    </style>
  </head>
  <body>
    <div class="box">
      <h1>UMD CDN Example</h1>
      <p>This page loads the global <code>fidbak</code> from the UMD bundle (simulating a CDN drop).</p>
      <h2>Try it</h2>
      <p>Click the floating button to leave feedback. Use the controls below to switch FAB variants.</p>
      <div style="margin:12px 0; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
        <label>Variant:</label>
        <button id="btn-icon" type="button">Icon</button>
        <button id="btn-text" type="button">Text</button>
        <label style="margin-left:16px">Palette:</label>
        <select id="palette">
          <option value="emerald">emerald</option>
          <option value="indigo">indigo</option>
          <option value="rose">rose</option>
          <option value="amber">amber</option>
          <option value="violet">violet</option>
          <option value="cyan">cyan</option>
        </select>
        <span style="margin-left:16px; padding-left:16px; border-left:1px solid #e5e7eb">
          <label><input type="checkbox" id="always-show" /> Always show comment</label>
        </span>
      </div>
      <h2>Section A</h2>
      <p>Select some text here and then click the FAB.</p>
    </div>
    <script>
      // Try to load local UMD from Vite /@fs first, then fall back to repo-relative path.
      function loadScript(src, onload, onerror) {
        const s = document.createElement('script');
        s.src = src;
        s.async = true;
        s.onload = onload;
        s.onerror = onerror;
        document.head.appendChild(s);
      }
      function boot() {
        if (typeof window.fidbak !== 'function') {
          console.error('[cdn-umd] fidbak global not found. Ensure the UMD file path is correct and built.');
          return;
        }
        startExample();
      }
      const fsPath = '/@fs/Users/ekene/CascadeProjects/fidbak/packages/widget/dist/fidbak.min.global.js';
      const relPath = '../../packages/widget/dist/fidbak.min.global.js';
      loadScript(fsPath, boot, () => loadScript(relPath, boot, () => {
        console.error('[cdn-umd] Failed to load UMD from both /@fs and relative path.');
      }));
    </script>
    <script>
      // Helper: get query param
      function qp(k){
        const u = new URL(location.href); return u.searchParams.get(k);
      }
      const apiBaseUrl = qp('api') || undefined; // e.g. ?api=http://127.0.0.1:8787
      function startExample() {
        const getAlwaysShow = () => document.getElementById('always-show').checked;
        const common = {
          siteId: 'puma-docs',
          position: 'br',
          draggable: true,
          includeQuery: false,
          debounceMs: 0,
          themeOverrides: {
            fontFamily: 'Inter, system-ui, sans-serif',
            radius: { card: 20, input: 16, button: 24, thumb: 24, close: 24 },
          },
        };
        window.fidbak('init', Object.assign({}, common, {
          apiBaseUrl,
          fabVariant: 'text',
          fabText: 'Feedback',
          hotkeyLabel: 'F',
          alwaysShowComment: getAlwaysShow(),
        }));
        // Controls
        document.getElementById('btn-icon').addEventListener('click', () => {
          window.fidbak('init', Object.assign({}, common, { apiBaseUrl, theme: `auto:${document.getElementById('palette').value}`, fabVariant: 'icon', alwaysShowComment: getAlwaysShow() }));
        });
        document.getElementById('btn-text').addEventListener('click', () => {
          window.fidbak('init', Object.assign({}, common, { apiBaseUrl, theme: `auto:${document.getElementById('palette').value}`, fabVariant: 'text', fabText: 'Feedback', hotkeyLabel: 'F', alwaysShowComment: getAlwaysShow() }));
        });
        document.getElementById('palette').addEventListener('change', () => {
          // Re-render with current variant; default to text
          window.fidbak('init', Object.assign({}, common, { apiBaseUrl, theme: `auto:${document.getElementById('palette').value}`, fabVariant: 'text', fabText: 'Feedback', hotkeyLabel: 'F', alwaysShowComment: getAlwaysShow() }));
        });
        document.getElementById('always-show').addEventListener('change', () => {
          // Re-init with current settings
          window.fidbak('init', Object.assign({}, common, { apiBaseUrl, theme: `auto:${document.getElementById('palette').value}`, fabVariant: 'text', fabText: 'Feedback', hotkeyLabel: 'F', alwaysShowComment: getAlwaysShow() }));
        });
      }
    </script>
